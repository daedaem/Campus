<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.project.dao.SnsDao">

    <!-- snsPost -->
    <insert id="snsInsert" parameterType="com.ssafy.project.dto.SnsDto" useGeneratedKeys="true" keyProperty="snsNo">
        INSERT INTO sns ( userNo, snsContent, snsCreateTime )
                    VALUES ( #{userNo}, #{snsContent}, now() )
    </insert>

    <select id="snsList" parameterType="map" resultType="com.ssafy.project.dto.SnsDto">
        SELECT s.snsNo, s.userNo, 
                s.snsContent, s.snsCreateTime, u.userProfileImage
            FROM sns s, user u
            WHERE s.userNo = u.userNo
            ORDER BY s.snsNo DESC
    </select>

    <update id="snsUpdate" parameterType="com.ssafy.project.dto.SnsDto">
        UPDATE SNS
            SET snsContent = #{snsContent}
            WHERE snsNo = #{snsNo}
    </update>

    <delete id="snsDelete" parameterType="int">
        DELETE FROM sns WHERE snsNo = #{snsNo}
    </delete>

    <!-- search word-->
    <select id="snsListSearchList" parameterType="map" resultType="com.ssafy.project.dto.SnsDto">
        SELECT s.snsNo, s.userNo, s.userNickname,
                s.snsContent, s.snsCreateTime, u.userProfileImage
            FROM SNS s, user u
            WHERE s.userno = u.userNo
                AND s.snsContent LIKE CONCAT('%', #{searchword}, '%')
            ORDER BY s.snsNo DESC


    <!-- snsImage -->

    <insert id="snsImageInsert" parameterType="com.ssafy.project.dto.SnsImageDto">
        INSERT INTO snsImage ( snsNo, snsImageName, snsImageSize, snsImageContentType, snsImageUrl)
                    VALUES ( #{snsNo}, #{snsImageName}, #{snsImageSize}, #{snsImageContentType}, #{snsImageUrl} )
    </insert>

    <select id="snsImageList" parameterType="int" resultType="com.ssafy.project.dto.SnsImageDto">
        SELECT snsNo, snsImageNo, snsImageName, snsImageSize, snsImageContentType,
                snsImageUrl, regDt
            FROM snsImage
            WHERE snsNo = #{snsNo}
    </select>

    <!-- update 추가? -->

    <delete id="snsImageDelete" parameterType="int">
        DELETE FROM snsImage WHERE snsNo = #{snsNo}
    </delete>

    <!--<delete id="snsImageUrlDeleteList" parameterType="int" resultType="string">-->

    <insert id="snsLikeInsert" parameterType="map">
        INSERT INTO snsLike ( snsNo, userNo )
                    VALUES ( #{snsNo}, #{userNo} )
    </insert>

    <delete id="snsLikeDelete" parameterType="int">
        DELETE FROM snsLike where userNo = #{userNo}
    </delete>


